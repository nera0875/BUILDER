#!/bin/bash

# Display Plan V2 - User-friendly format (non-technical)
# Shows WHAT the app does, not HOW it's coded

# Colors
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
MAGENTA='\033[0;35m'
CYAN='\033[0;36m'
WHITE='\033[1;37m'
BOLD='\033[1m'
DIM='\033[2m'
RESET='\033[0m'

# Box drawing
TOP_LEFT="‚ïî"
TOP_RIGHT="‚ïó"
BOTTOM_LEFT="‚ïö"
BOTTOM_RIGHT="‚ïù"
HORIZONTAL="‚ïê"
VERTICAL="‚ïë"
T_LEFT="‚ï†"
T_RIGHT="‚ï£"

# Width
WIDTH=65

# Functions
print_line() {
    local char="$1"
    printf "${char}%.0s" $(seq 1 $WIDTH)
}

print_header() {
    echo -e "${CYAN}${TOP_LEFT}$(print_line $HORIZONTAL)${TOP_RIGHT}${RESET}"
    printf "${CYAN}${VERTICAL}${RESET} ${BOLD}${WHITE}%-$((WIDTH-2))s${RESET} ${CYAN}${VERTICAL}${RESET}\n" "$1"
    echo -e "${CYAN}${T_LEFT}$(print_line $HORIZONTAL)${T_RIGHT}${RESET}"
}

print_section() {
    echo -e "${CYAN}${VERTICAL}${RESET} ${BOLD}${YELLOW}$1${RESET}"
}

print_feature() {
    printf "${CYAN}${VERTICAL}${RESET}   ${GREEN}‚úÖ${RESET} %-$((WIDTH-6))s ${CYAN}${VERTICAL}${RESET}\n" "$1"
}

print_item() {
    printf "${CYAN}${VERTICAL}${RESET}   ${BLUE}‚Ä¢${RESET} %-$((WIDTH-5))s ${CYAN}${VERTICAL}${RESET}\n" "$1"
}

print_tech() {
    printf "${CYAN}${VERTICAL}${RESET} ${DIM}  $1${RESET}"
    local padding=$((WIDTH - ${#1} - 3))
    printf "%${padding}s" ""
    echo -e "${CYAN}${VERTICAL}${RESET}"
}

print_separator() {
    echo -e "${CYAN}${T_LEFT}$(print_line $HORIZONTAL)${T_RIGHT}${RESET}"
}

print_footer() {
    echo -e "${CYAN}${BOTTOM_LEFT}$(print_line $HORIZONTAL)${BOTTOM_RIGHT}${RESET}"
}

print_empty() {
    printf "${CYAN}${VERTICAL}${RESET} %-$((WIDTH-2))s ${CYAN}${VERTICAL}${RESET}\n" ""
}

# Parse arguments (JSON-like input)
PROJECT_NAME="$1"
shift

FEATURES=()
ACCESS=""
DATA=""
DESIGN=()
STACK=""

# Parse remaining arguments
while [[ $# -gt 0 ]]; do
    case "$1" in
        --feature)
            FEATURES+=("$2")
            shift 2
            ;;
        --access)
            ACCESS="$2"
            shift 2
            ;;
        --data)
            DATA="$2"
            shift 2
            ;;
        --design)
            DESIGN+=("$2")
            shift 2
            ;;
        --stack)
            STACK="$2"
            shift 2
            ;;
        *)
            shift
            ;;
    esac
done

# Display
echo ""
echo ""
print_header "üìã PLAN: $PROJECT_NAME"
print_empty

# Features
if [ ${#FEATURES[@]} -gt 0 ]; then
    print_section "üéØ FONCTIONNALIT√âS"
    for feature in "${FEATURES[@]}"; do
        print_feature "$feature"
    done
    print_empty
fi

# Access
if [ -n "$ACCESS" ]; then
    print_section "üë§ ACC√àS"
    print_item "$ACCESS"
    print_empty
fi

# Data
if [ -n "$DATA" ]; then
    print_section "üíæ DONN√âES"
    print_item "$DATA"
    print_empty
fi

# Design
if [ ${#DESIGN[@]} -gt 0 ]; then
    print_section "üì± DESIGN"
    for item in "${DESIGN[@]}"; do
        print_item "$item"
    done
    print_empty
fi

# Tech details (collapsed, for reference)
if [ -n "$STACK" ]; then
    print_separator
    print_tech "‚öôÔ∏è  D√©tails techniques: $STACK"
fi

print_footer

# Prompt
echo ""
echo -e "${GREEN}‚úÖ Ce plan te convient?${RESET}"
echo -e "${BLUE}‚ùì Besoin d'ajustements?${RESET} (je peux poser d'autres questions)"
echo ""
read -p "$(echo -e ${BOLD}Valide pour continuer? [y/n]:${RESET} )" -n 1 -r
echo

if [[ $REPLY =~ ^[Yy]$ ]]; then
    echo -e "${GREEN}‚úÖ Cr√©ation lanc√©e!${RESET}"
    exit 0
else
    echo -e "${YELLOW}‚ö†Ô∏è  Annul√© - demande des ajustements${RESET}"
    exit 1
fi
