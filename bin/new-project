#!/bin/bash

# BUILDER - Rapid Project Creation
# Usage: new-project [project-name]

set -e

PROJECT_NAME="$1"

if [ -z "$PROJECT_NAME" ]; then
  echo "âŒ Usage: new-project [project-name]"
  echo "   Example: new-project task-timer"
  exit 1
fi

# Validate project name (kebab-case)
if ! [[ "$PROJECT_NAME" =~ ^[a-z0-9-]+$ ]]; then
  echo "âŒ Project name must be kebab-case (lowercase, hyphens only)"
  echo "   Example: task-timer, admin-dashboard, e-commerce"
  exit 1
fi

echo "ğŸš€ Creating project: $PROJECT_NAME"
echo ""

# Path obligatoire
PROJECT_DIR="/home/pilote/projet/secondaire/$PROJECT_NAME"

# Check if already exists
if [ -d "$PROJECT_DIR" ]; then
  echo "âŒ Project already exists: $PROJECT_DIR"
  echo "   Use: cd $PROJECT_DIR"
  exit 1
fi

# Create project directory
echo "ğŸ“ Creating directory..."
mkdir -p "$PROJECT_DIR"
cd "$PROJECT_DIR"

# Clone BUILDER/.stack/ (base frontend)
echo "ğŸ“¦ Cloning BUILDER stack..."
cp -r /home/pilote/projet/primaire/BUILDER/.stack/* .

# Create .build/ structure
echo "ğŸ“‹ Initializing .build/..."
mkdir -p .build/decisions

# context.md
cat > .build/context.md << 'EOF'
# Project Context

## Stack Technique
- Frontend: Next.js 16 + shadcn/ui (57 components)
- Styling: Tailwind CSS v4
- Dark mode: Included (themes.css)

## Architecture Actuelle
(Will be populated after first features)

## Conventions Ã‰tablies
- Components: components/ui/ (shadcn)
- Pages: app/
- Utils: lib/utils.ts
EOF

# timeline.md
cat > .build/timeline.md << EOF
# Timeline

## $(date +"%Y-%m-%d %H:%M") - Project Initialization

**Type**: Setup
**Status**: âœ“ Completed

### Changes
- Project created
- BUILDER stack cloned (57 shadcn components)
- .build/ structure initialized

### Notes
- Ready for feature development
EOF

# tasks.md
cat > .build/tasks.md << 'EOF'
# Tasks

## ğŸš€ In Progress
(No tasks yet)

## ğŸ”´ Blocked
(No blockers)

## ğŸ“‹ Next Up
(No tasks planned)

## âœ… Recently Completed
(No tasks completed)
EOF

# issues.md
cat > .build/issues.md << 'EOF'
# Issues

## ğŸ”´ Open Issues
(No issues yet)

## âœ… Resolved Issues
(No issues resolved yet)
EOF

# specs.md
cat > .build/specs.md << EOF
# Specs - $PROJECT_NAME

> **CrÃ©Ã©**: $(date +"%Y-%m-%d")
> **DerniÃ¨re mise Ã  jour**: $(date +"%Y-%m-%d")

---

## ğŸ¯ Vision Projet

(To be defined)

---

## ğŸ“¦ Stack Technique

**Frontend:**
- Next.js 16
- shadcn/ui (57 components)
- Tailwind CSS v4

**Backend:**
- (To be defined if needed)

**Database:**
- (To be defined if needed)

---

## ğŸ— Architecture

(To be defined for complex full-stack projects)

---

## ğŸ“‹ Features Roadmap

### Phase 1 - MVP
- [ ] (Features to be added)

---

## ğŸ—‚ Data Models

(Models will be added after backend creation)

---

## ğŸ“Œ ADRs ClÃ©s

(Architecture decisions will be documented here)

---

## âš ï¸ Contraintes & DÃ©cisions

(Technical constraints will be documented here)
EOF

# Install dependencies
echo "ğŸ“¥ Installing dependencies..."
npm install --silent

# Success message
echo ""
echo "âœ… Project $PROJECT_NAME created successfully!"
echo ""
echo "ğŸ“ Location: $PROJECT_DIR"
echo ""
echo "ğŸ¯ Next steps:"
echo "   1. cd $PROJECT_DIR"
echo "   2. Tell Claude what features you want"
echo "   3. Claude will build + deploy automatically"
echo ""
echo "ğŸ”— Preview will be available at: http://89.116.27.88:[auto-assigned-port]"
echo ""
